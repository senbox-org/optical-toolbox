<!--
  ~ Copyright (C) 2017 by CS ROMANIA
  ~
  ~ This program is free software; you can redistribute it and/or modify it
  ~ under the terms of the GNU General Public License as published by the Free
  ~ Software Foundation; either version 3 of the License, or (at your option)
  ~ any later version.
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
  ~ more details.
  ~
  ~ You should have received a copy of the GNU General Public License along
  ~ with this program; if not, see http://www.gnu.org/licenses/
  -->

<html>
<head>
    <title>SNAP Forest Cover Change Processor</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <link rel="stylesheet" href="style.css">
</head>

<body>
<table class="header">
    <tr class="header">
        <td class="header">&nbsp;
            Forest Cover Change Processor</td>
        <td class="header" align="right"><a href="nbdocs://org.esa.snap.snap.help/org/esa/snap/snap/help/docs/general/overview/SnapOverview.html"><img src="images/snap_header.jpg" border=0></a></td>
    </tr>
</table>

<p><br/></p>
<p>
    The Forest Cover Change Processor is a multi-steps iterative process that transform two date images into one forest change product.
    The overall principle of the algorithm is to identify the forest objects showing higher reflectance differences between the two images than the other forest objects.
</p>
<p>
    The memory required to process the images may be very high and therefore leads to unfeasibility on slow computers.
</p>
<p>
    The two major steps are:
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    (i) a multi-date multispectral image segmentation and
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    (ii) a change detection procedure including:
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    - a binary forest/non forest classification of the clusters composed of a selection of forest training set based on a reference map, a multivariate iterative
    trimming to remove the outliers, and a spectral analysis based on the Mahalanobis distance;
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    - a change detection under a forest mask generated by the union of forest classification of both dates.
</p>
<p>
    The processing chain is run by pairs of images. Each product must contain at least 4 bands with the following spectral wave length:
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    RED: 0.63 &#xb5m - 0.69 &#xb5m
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    NIR: 0.76 &#xb5m - 0.9 &#xb5m
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    SWIR: 1.55 &#xb5m - 1.75 &#xb5m
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    SWIR: 2.08 &#xb5m - 2.35 &#xb5m
</p>
<p>
    Forest masks are produced in two major steps:
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    (i) A forest training set is created with the objects covered by a percentage (95% by default) of Tree cover class extracted from a reference map (by default CCI Land Cover Map)
    (<a href="http://maps.elie.ucl.ac.be/CCI/viewer/index.php">originally CCI Land Cover map</a>):
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    - Segmentation objects are first converted into raster pixels.
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    - Tree cover label from recent and old images objects rasterized (same objects for both dates) are extracted from the reference map. For the CCI Land Cover legend, Tree Cover labels are [40, 50, 60, 61, 62, 70, 71, 72, 80, 81, 82, 90, 100, 110, 160, 170].
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    - Areas statistics are then computed and objects with at least 95% (be default, the percentage can be modified) Tree cover are selected for the forest/non forest mask training set. This method allows to have set of homogeneous tree cover objects.</p>
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    (ii) The training set will be updated using the a trimming procedure based on the Mahalanobis distance to remove the extreme values that behave like outliers with a threshold based on the chi distribution algorithm
     with 3 levels of confidence 0.9, 0.95 and 0.99. The trimming is done repetitive on smaller windows using the method of moving window algorithm (a small window that moves to cover the hole image and overlaps itself
    over a portion on both directions) so that the overall result is more precise.
</p>

<h4>I/O Parameters</h4>
<table border="0">
    <tr>
        <td style="border-width:0;" valign="top">
            <h5>Source Products</h5>

            <p class="i1">
                <b>Current Source Product</b>
                Specify the current source product which will be used to compute the forest cover change. The current source product represents the
                most current product by date.
            </p>
            <p class="i1">
                <b>Previous Source Product</b>
                Specify the previous source product which will be used to compute the forest cover change. The previous source product represents a product that is
                older than the current source product.
            </p>
            <p>
                <b>NOTE:</b> The two input products must have the same geo-spatial latitude and longitude and the same raster sizes. The two source products must be from
                the same period of the year for a more precise result.
            </p>

            <h5>Target Product</h5>
            <p class="i1">
                <b>Name:</b>
                Used to specify the name of the target product.
            </p>

            <p class="i1">
                <b>Save as:</b>
                Used to specify whether the target product should be saved to the file system. The
                combo box presents a list of file formats.
                The text field allows to specify a target directory. <br>
            </p>

            <p class="i1">
                <b>Open in SNAP:</b>
                Used to specify whether the target product should be opened in the application.
                When the target product is not saved, it is opened automatically.
            </p></td>
        <td style="border-width:0;" valign="top">
            <img src="images/io-parameters.png">
        </td>
    </tr>
</table>

<h4>Processing Parameters</h4>
<table border="0">
    <tr>
        <td style="border-width:0;" valign="top">
            <p class="i1">
                <b>Forest cover percentage:</b>
                Specify the  forest cover percentage for each segmentation object. It represents the percent of pixels from a segmentation
                object that are marked as forest in the CCI Land Cover map.
            </p>

            <p class="i1">
                <b>Merging cost criterion:</b>
                Specify the type to compute the cost between adjacent segments. The merging costs are based on a homogeneity criterion and can represent
                not only how two similar segments are but also how homogeneous the resulting larger segment would be.
            </p>

            <p class="i1">
                <b>Region merging criterion:</b>
                Specify for a given segment the way to choose the adjacent segment to be merged with.
            </p>

            <p class="i1">
                <b>Total iterations:</b>
                Specify the total number of iterations. The higher the number of iterations, the lower the number of segmentation objects is. On a segmentation
                step the number of segmentation objects may be reduced by merging the adjacent segments based on the merging cost criterion and
                region merging criterion.
            </p>

            <p class="i1">
                <b>Threshold:</b>
                Specify the threshold which is compared with the merging cost. This threshold avoids undersegmentation. The higher the value of the threshold the least chances
                of undersegmentation.
            </p>

            <p class="i1">
                <b>Spectral weight:</b>
                Specify the spectral weight.
            </p>

            <p class="i1">
                <b>Shape weight:</b>
                Specify the shape weight.
            </p>
            <p class="i1">
                <b>Name :</b>
                Specify the name of the Land Cover Map to be used from a list of land cover maps integrated in the application. The default land cover map is  CCI Land Cover map
            </p>

            <p class="i1">
                <b>Map Indices:</b>
                Specify the indices from the selected land cover map,  to be used as a mask of forest for the Forest cover change processor. An example is:
                40, 50, 60, 61, 62, 70, 71, 72, 80,81, 82,  90,100, 110,160, 170. All indices must be integers and separated by a comma.
            </p>
            <p class="nospace">
                <b>NOTE:</b> The indices field must not be empty.
            </p>
            <p class="i1">
                <b>Recent Date Product Mask and Previous Date Product Mask:</b>
                Specify a raster mask to be added to the target product. If no masks are introduced and the input products are of type sentinel 2, the output product will be influenced by
                scl_dark_feature_shadow, scl_cloud_shadow, scl_water, scl_cloud_low_proba, scl_cloud_medium_proba, scl_cloud_high_proba, scl_thin_cirrus, scl_snow_ice masks from the source products in order
                to reduce the false positives from the output.
            </p>
            <p class="nospace">
                <b>NOTE:</b> Input mask must be a binary raster with one band.
            </p>
            <p class="i1">
                <b>Degrees of freedom:</b>
               Specifies the degrees of freedom for the chi distribution algorithm. The smaller the value, the more segments are eliminated on the trimming process.
            </p>
            <p>
                <b>NOTE:</b> The threshold, spectral weight and shape weight may vary according to the pixel values of the raster. The standard values for spectral weight and for shape weight is 0.5
                and for threshold is 100. Sometimes, to detect more precisely the segmentation objects, the processor needs to self-execute several times with different parameter values.
            </p>
        </td>
        <td style="border-width:0;" valign="top">
            <img src="images/processing-parameters.png">
        </td>
    </tr>
</table>

<hr>
</body>
</html>
